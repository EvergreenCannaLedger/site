{
  "hash": "037b895ede95267cae9a5b67d7af6013",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2021-01-31_BlkFri_to_NYE_2021_Weekly_Tables\"\neditor: visual\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nWeekly Totals\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|Week       | TotalRevenue| TotalUnits| TotalDiscount|\n|:----------|------------:|----------:|-------------:|\n|2021-11-29 |      7302.42|       2622|        509.22|\n|2021-12-06 |      7637.70|         72|       1781.16|\n|2021-12-13 |     10928.76|        372|       2491.44|\n|2021-12-20 |      7326.18|       -408|       2132.88|\n|2021-12-27 |      1763.82|        246|        365.28|\n\n\n:::\n\n::: {.cell-output-display}\n![](2021-01-31_BlkFri_to_NYE_2021_Weekly_Tables_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nWeekly Revenue by License\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweekly_licensee_summary <- sales_weekly %>%\n  filter(Revenue > 0) %>%\n  group_by(Week, LicenseeId, BusinessName) %>%\n  summarise(\n    WeeklyRevenue = sum(Revenue, na.rm = TRUE),\n    WeeklyUnits = sum(Quantity, na.rm = TRUE),\n    .groups = \"drop\"\n  ) %>%\n  arrange(Week, desc(WeeklyRevenue))\n\n# View top licensees per week\nprint(weekly_licensee_summary %>% group_by(Week) %>% slice_max(WeeklyRevenue, n = 5))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 × 5\n# Groups:   Week [5]\n   Week       LicenseeId BusinessName                  WeeklyRevenue WeeklyUnits\n   <date>     <chr>      <chr>                                 <dbl>       <dbl>\n 1 2021-11-29 1031       LUCID                                 3832.        1828\n 2 2021-11-29 1031       GREEN LADY LACEY                      1916.         914\n 3 2021-11-29 2105       LUCID AUBURN, 21+ CANNABIS, …         1094.         -90\n 4 2021-11-29 39         LUCID PUYALLUP                         461.         -30\n 5 2021-12-06 2105       LUCID AUBURN, 21+ CANNABIS, …         3244.        -234\n 6 2021-12-06 1031       LUCID                                 2096.         276\n 7 2021-12-06 39         LUCID PUYALLUP                        1250.        -108\n 8 2021-12-06 1031       GREEN LADY LACEY                      1048.         138\n 9 2021-12-13 1031       LUCID                                 3953.         468\n10 2021-12-13 2105       LUCID AUBURN, 21+ CANNABIS, …         3372.        -210\n11 2021-12-13 1031       GREEN LADY LACEY                      1977.         234\n12 2021-12-13 39         LUCID PUYALLUP                        1627.        -120\n13 2021-12-20 2105       LUCID AUBURN, 21+ CANNABIS, …         2718.        -174\n14 2021-12-20 39         LUCID PUYALLUP                        2288.        -138\n15 2021-12-20 1031       LUCID                                 1547.         -64\n16 2021-12-20 1031       GREEN LADY LACEY                       773.         -32\n17 2021-12-27 2105       LUCID AUBURN, 21+ CANNABIS, …          722.         -54\n18 2021-12-27 1031       LUCID                                  504          216\n19 2021-12-27 39         LUCID PUYALLUP                         286.         -24\n20 2021-12-27 1031       GREEN LADY LACEY                       252          108\n```\n\n\n:::\n\n```{.r .cell-code}\n# Optional: plot top N licensees\ntop_licensees <- weekly_licensee_summary %>%\n  group_by(BusinessName) %>%\n  summarise(Total = sum(WeeklyRevenue)) %>%\n  slice_max(Total, n = 5) %>%\n  pull(BusinessName)\n\nweekly_licensee_summary %>%\n  filter(BusinessName %in% top_licensees) %>%\n  ggplot(aes(x = Week, y = WeeklyRevenue, color = BusinessName)) +\n  geom_line(size = 1.1) +\n  scale_y_continuous(labels = dollar_format()) +\n  labs(\n    title = \"Licensee Revenue per Week\",\n    x = \"Week\",\n    y = \"Revenue\",\n    color = \"Licensed Business Name\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2021-01-31_BlkFri_to_NYE_2021_Weekly_Tables_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nWeekly Discounting Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweekly_discounts <- sales_weekly %>%\n  filter(Revenue > 0) %>%\n  group_by(Week) %>%\n  summarise(\n    AvgDiscount = mean(Discount, na.rm = TRUE),\n    TotalDiscount = sum(Discount, na.rm = TRUE),\n    PercentDiscounted = mean(Discount > 0) * 100,\n    .groups = \"drop\"\n  )\n\n# View table\nprint(weekly_discounts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  Week       AvgDiscount TotalDiscount PercentDiscounted\n  <date>           <dbl>         <dbl>             <dbl>\n1 2021-11-29       0.176          509.              2.70\n2 2021-12-06       1.58          1781.             28.7 \n3 2021-12-13       1.72          2491.             23.1 \n4 2021-12-20       3.49          2133.             52.9 \n5 2021-12-27       0.857          365.             16.9 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Optional: plot discount trends\nggplot(weekly_discounts, aes(x = Week)) +\n  geom_line(aes(y = AvgDiscount), color = \"purple\", size = 1.1) +\n  geom_point(aes(y = AvgDiscount), color = \"purple\", size = 2) +\n  scale_y_continuous(name = \"Average Discount ($)\", labels = dollar_format()) +\n  labs(\n    title = \"Weekly Average Discount\",\n    x = \"Week\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](2021-01-31_BlkFri_to_NYE_2021_Weekly_Tables_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n| Section                   | Output                                      |\n| ------------------------- | ------------------------------------------- |\n| `weekly_totals`           | Revenue, Units, Discount totals per week    |\n| `weekly_licensee_summary` | Revenue & units per licensee per week       |\n| `weekly_discounts`        | Avg & % of discounts per week               |\n| Visualizations            | Revenue, discounts, and CCRS-derived sellers by week |\n\n",
    "supporting": [
      "2021-01-31_BlkFri_to_NYE_2021_Weekly_Tables_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}